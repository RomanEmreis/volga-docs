import{_ as n,c as a,e,d as t}from"./app-yBO_JKoh.js";const p={};function o(c,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="server-sent-events-sse" tabindex="-1"><a class="header-anchor" href="#server-sent-events-sse"><span>Server-Sent Events (SSE)</span></a></h1><p>Волга включает встроенную поддержку <a href="https://developer.mozilla.org/ru/docs/Web/API/Server-sent_events" target="_blank" rel="noopener noreferrer">Server-Sent Events (SSE)</a>, что позволяет вам реализовать одностороннюю связь в реальном времени от сервера к клиенту в ваших веб-приложениях. Эта функция доступна по умолчанию и совместима с протоколами HTTP/1 и HTTP/2.</p><h1 id="базовая-реализация" tabindex="-1"><a class="header-anchor" href="#базовая-реализация"><span>Базовая реализация</span></a></h1><p>В примере ниже показано, как создать простую конечную точку SSE. Она сопоставляет запрос <code>GET</code> с маршрутом <code>/events</code>, устанавливает Content Type как <code>text/event-stream</code> и непрерывно отправляет сообщение <code>&quot;Hello, world!&quot;</code> раз в секунду, пока клиент не отключится:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">use</span> <span class="token namespace">volga<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">App</span><span class="token punctuation">,</span> <span class="token namespace">http<span class="token punctuation">::</span>sse<span class="token punctuation">::</span></span><span class="token class-name">Message</span><span class="token punctuation">,</span> sse_stream<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute attr-name">#[tokio::main]</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> app <span class="token operator">=</span> <span class="token class-name">App</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    app<span class="token punctuation">.</span><span class="token function">map_get</span><span class="token punctuation">(</span><span class="token string">&quot;/events&quot;</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Создаем поток сообщений с отправкой раз в секунду</span></span>
<span class="line">        <span class="token macro property">sse_stream!</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">loop</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">yield</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">                <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="настроика-сообщении" tabindex="-1"><a class="header-anchor" href="#настроика-сообщении"><span>Настройка сообщений</span></a></h2><p>Волга предоставляет структуру <a href="https://docs.rs/volga/latest/volga/http/endpoints/args/sse/struct.Message.html" target="_blank" rel="noopener noreferrer"><code>Message</code></a>, которая поможет вам создавать и настраивать сообщения SSE.</p><p>Для простых текстовых сообщений используйте метод <a href="https://docs.rs/volga/latest/volga/http/endpoints/args/sse/struct.Message.html#method.data" target="_blank" rel="noopener noreferrer"><code>data()</code></a>, как показано выше. Если вам необходимо отправить структурированные данные, такие как JSON, используйте метод <a href="https://docs.rs/volga/latest/volga/http/endpoints/args/sse/struct.Message.html#method.json" target="_blank" rel="noopener noreferrer"><code>json()</code></a>, который принимает любой тип, реализующий типаж <a href="https://docs.rs/serde/1.0.219/serde/ser/trait.Serialize.html" target="_blank" rel="noopener noreferrer"><code>serde::Serialize</code></a>:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">use</span> <span class="token namespace">volga<span class="token punctuation">::</span>http<span class="token punctuation">::</span>sse<span class="token punctuation">::</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Serialize</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute attr-name">#[derive(Serialize)]</span></span>
<span class="line"><span class="token keyword">struct</span> <span class="token type-definition class-name">SseData</span> <span class="token punctuation">{</span></span>
<span class="line">    data<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> payload <span class="token operator">=</span> <span class="token class-name">SseData</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В дополнение к этому, <code>Message</code> также поддерживает настройку имени события (поле <code>event</code>), идентификатора (поле <code>id</code>), комментариев (поле <code>comment</code>) и интервала попыток повторного подключения клиента (поле <code>retry</code>). Подробную информацию о формате сообщения SSE см. в <a href="https://developer.mozilla.org/ru/docs/Web/API/Server-sent_events/Using_server-sent_events#%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82_%D0%BF%D0%BE%D1%82%D0%BE%D0%BA%D0%B0_%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B9" target="_blank" rel="noopener noreferrer">руководстве MDN</a>.</p><p>Полный пример использования можно так же найти по по <a href="https://github.com/RomanEmreis/volga/blob/main/examples/sse/src/main.rs" target="_blank" rel="noopener noreferrer">ссылке</a>.</p>`,11)]))}const i=n(p,[["render",o]]),u=JSON.parse('{"path":"/ru/protocols-realtime/sse.html","title":"Server-Sent Events (SSE)","lang":"ru-RU","frontmatter":{},"git":{"updatedTime":1770480980000,"contributors":[{"name":"Roman Emreis","username":"","email":"Roman_Emreis@epam.com","commits":2},{"name":"RomanEmreis","username":"RomanEmreis","email":"39233213+RomanEmreis@users.noreply.github.com","commits":2,"url":"https://github.com/RomanEmreis"}],"changelog":[{"hash":"c4d35ede5b13c61486e4c7956d92b8ec8b0c05ed","time":1770480980000,"email":"39233213+RomanEmreis@users.noreply.github.com","author":"Roman","message":"Refactor SSE endpoint to use sse_stream (#12)"},{"hash":"53a947230481769d7454b5a9793d12bc5f150247","time":1768761219000,"email":"39233213+RomanEmreis@users.noreply.github.com","author":"Roman","message":"Reorganize docs sidebar and move SSE to protocols (#6)"},{"hash":"446f2cb336c3db45ba44b4f07f646b570e054215","time":1753605804000,"email":"r.emreis@outlook.com","author":"Roman Emreis","message":"new release"},{"hash":"be45b5b78d0d2925cbe8628c96fe06acf0d952b4","time":1744624313000,"email":"Roman_Emreis@epam.com","author":"Roman Emreis","message":"new release"}]},"filePathRelative":"ru/protocols-realtime/sse.md"}');export{i as comp,u as data};

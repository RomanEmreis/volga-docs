import{_ as s,c as a,e,d as t}from"./app-yBO_JKoh.js";const p={};function i(o,n){return t(),a("div",null,n[0]||(n[0]=[e(`<h1 id="rate-limiting" tabindex="-1"><a class="header-anchor" href="#rate-limiting"><span>Rate Limiting</span></a></h1><p>Volga provides a built-in, high-performance rate limiting system designed for HTTP APIs and microservices. It supports multiple algorithms, flexible partition keys, and can be applied globally, per route group, or per route.</p><p>This guide demonstrates basic usage using the <strong>Fixed Window</strong> algorithm.</p><h2 id="enabling-rate-limiting" tabindex="-1"><a class="header-anchor" href="#enabling-rate-limiting"><span>Enabling Rate Limiting</span></a></h2><p>Rate limiting is an optional feature.</p><p>Enable it explicitly in <code>Cargo.toml</code>:</p><div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml"><pre><code class="language-toml"><span class="line"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token key property">volga</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;rate-limiting&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Or enable all features:</p><div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml"><pre><code class="language-toml"><span class="line"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token key property">volga</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="core-concepts" tabindex="-1"><a class="header-anchor" href="#core-concepts"><span>Core Concepts</span></a></h2><p>Before diving into examples, it helps to understand the building blocks:</p><h3 id="rate-limiting-policy" tabindex="-1"><a class="header-anchor" href="#rate-limiting-policy"><span>Rate Limiting Policy</span></a></h3><p>A <strong>policy</strong> defines:</p><ul><li>the rate limiting algorithm (e.g. fixed window)</li><li>the maximum number of requests</li><li>the window duration</li><li>optional eviction behavior</li><li>an optional name</li></ul><p>Policies are configured once at the application level.</p><h3 id="partition-key" tabindex="-1"><a class="header-anchor" href="#partition-key"><span>Partition Key</span></a></h3><p>A <strong>partition key</strong> determines how requests are grouped.</p><p>Common examples:</p><ul><li>Client IP</li><li>Authenticated user</li><li>API key</li><li>Query or path parameter</li></ul><p>Volga provides helpers under <code>volga::rate_limiting::by</code>.</p><h3 id="where-rate-limiting-can-be-applied" tabindex="-1"><a class="header-anchor" href="#where-rate-limiting-can-be-applied"><span>Where Rate Limiting Can Be Applied</span></a></h3><p>Rate limiting middleware can be attached to:</p><ul><li>the entire application (global)</li><li>a route group</li><li>a single route</li></ul><h2 id="defining-a-fixed-window-policy" tabindex="-1"><a class="header-anchor" href="#defining-a-fixed-window-policy"><span>Defining a Fixed Window Policy</span></a></h2><p>A fixed window rate limiter allows up to <em>N requests per time window</em>.</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token namespace">volga<span class="token punctuation">::</span>rate_limiting<span class="token punctuation">::</span></span><span class="token class-name">FixedWindow</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> fixed_window <span class="token operator">=</span> <span class="token class-name">FixedWindow</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This policy allows <strong>100 requests per 30 seconds</strong>.</p><h3 id="named-policies" tabindex="-1"><a class="header-anchor" href="#named-policies"><span>Named Policies</span></a></h3><p>Policies can be named and reused:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">let</span> burst <span class="token operator">=</span> <span class="token class-name">FixedWindow</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">with_name</span><span class="token punctuation">(</span><span class="token string">&quot;burst&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Named policies are useful when different routes require different limits.</p><h2 id="registering-the-policy" tabindex="-1"><a class="header-anchor" href="#registering-the-policy"><span>Registering the Policy</span></a></h2><p>Policies are registered on the application:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">use</span> <span class="token namespace">volga<span class="token punctuation">::</span></span><span class="token class-name">App</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> <span class="token keyword">mut</span> app <span class="token operator">=</span> <span class="token class-name">App</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">with_fixed_window</span><span class="token punctuation">(</span>burst<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At this point, the policy exists but is not yet active.</p><h2 id="applying-rate-limiting" tabindex="-1"><a class="header-anchor" href="#applying-rate-limiting"><span>Applying Rate Limiting</span></a></h2><h3 id="global-rate-limiting" tabindex="-1"><a class="header-anchor" href="#global-rate-limiting"><span>Global Rate Limiting</span></a></h3><p>Apply rate limiting to all incoming requests:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token keyword">use</span> <span class="token namespace">volga<span class="token punctuation">::</span>rate_limiting<span class="token punctuation">::</span></span>by<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use_fixed_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This limits all requests based on the client IP.</p><h3 id="using-a-named-policy" tabindex="-1"><a class="header-anchor" href="#using-a-named-policy"><span>Using a Named Policy</span></a></h3><p>To use a specific named policy:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line">app<span class="token punctuation">.</span><span class="token function">use_fixed_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">using</span><span class="token punctuation">(</span><span class="token string">&quot;burst&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="route-level-rate-limiting" tabindex="-1"><a class="header-anchor" href="#route-level-rate-limiting"><span>Route-Level Rate Limiting</span></a></h3><p>Rate limiting can be applied to individual routes:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line">app<span class="token punctuation">.</span><span class="token function">map_get</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span> upload_handler<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">fixed_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Or with a named policy:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line">app<span class="token punctuation">.</span><span class="token function">map_get</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span> upload_handler<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">fixed_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">using</span><span class="token punctuation">(</span><span class="token string">&quot;burst&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="route-group-rate-limiting" tabindex="-1"><a class="header-anchor" href="#route-group-rate-limiting"><span>Route Group Rate Limiting</span></a></h3><p>Rate limiting can also be applied to a group of routes:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line">app<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>api<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">fixed_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">map_get</span><span class="token punctuation">(</span><span class="token string">&quot;/status&quot;</span><span class="token punctuation">,</span> status_handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">map_post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span> upload_handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="partition-key-examples" tabindex="-1"><a class="header-anchor" href="#partition-key-examples"><span>Partition Key Examples</span></a></h2><p>Volga provides built-in helpers:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// Client IP address</span></span>
<span class="line"><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;x-api-key&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Custom HTTP header</span></span>
<span class="line"><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;tenant_id&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// Query parameter</span></span>
<span class="line"><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span>     <span class="token comment">// Path parameter</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When authentication is enabled:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">user</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>claims<span class="token closure-punctuation punctuation">|</span></span> claims<span class="token punctuation">.</span>sub<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You can also combine multiple keys by stacking middleware.</p><h2 id="other-algorithms" tabindex="-1"><a class="header-anchor" href="#other-algorithms"><span>Other Algorithms</span></a></h2><p>In addition to <strong>Fixed Window</strong>, Volga supports:</p><ul><li><strong>Sliding Window</strong> â€“ smoother request distribution</li><li>(More algorithms planned)</li></ul><p>The usage pattern remains the same:</p><div class="language-rust line-numbers-mode" data-highlighter="prismjs" data-ext="rs"><pre><code class="language-rust"><span class="line"><span class="token punctuation">.</span><span class="token function">with_sliding_window</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">sliding_window</span><span class="token punctuation">(</span><span class="token namespace">by<span class="token punctuation">::</span></span><span class="token function">ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Full example can be found <a href="https://github.com/RomanEmreis/volga/blob/main/examples/rate_limiting/src/main.rs" target="_blank" rel="noopener noreferrer">here</a>.</p>`,63)]))}const c=s(p,[["render",i]]),u=JSON.parse('{"path":"/en/middleware-infrastructure/rate-limiting.html","title":"Rate Limiting","lang":"en-US","frontmatter":{},"git":{"updatedTime":1770482703000,"contributors":[{"name":"Roman Emreis","username":"","email":"r.emreis@outlook.com","commits":1},{"name":"RomanEmreis","username":"RomanEmreis","email":"39233213+RomanEmreis@users.noreply.github.com","commits":2,"url":"https://github.com/RomanEmreis"}],"changelog":[{"hash":"65fa823c83e2aa31986d88d1e4e8a20152fad2c2","time":1770482703000,"email":"39233213+RomanEmreis@users.noreply.github.com","author":"Roman","message":"Replace docs root README with redirect to /en (#13)"},{"hash":"53a947230481769d7454b5a9793d12bc5f150247","time":1768761219000,"email":"39233213+RomanEmreis@users.noreply.github.com","author":"Roman","message":"Reorganize docs sidebar and move SSE to protocols (#6)"},{"hash":"c1efb6574d93d5b386148e5d89de673f79228db1","time":1768749966000,"email":"r.emreis@outlook.com","author":"Roman Emreis","message":"new release"}]},"filePathRelative":"en/middleware-infrastructure/rate-limiting.md"}');export{c as comp,u as data};
